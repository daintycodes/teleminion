<!-- File Row Partial -->
<tr id="file-row-{{ file.id }}" class="border-b border-gray-800/50 hover:bg-gray-800/30">
    <!-- Checkbox -->
    <td class="py-3">
        {% if file.status == 'PENDING' %}
        <input type="checkbox" class="file-checkbox rounded bg-gray-700 border-gray-600" data-file-id="{{ file.id }}"
            onchange="toggleFileSelection(this, {{ file.id }})">
        {% endif %}
    </td>

    <!-- Type Icon -->
    <td class="py-3">
        {% if file.file_type == 'audio' %}
        <span class="inline-flex items-center gap-1 px-2 py-1 rounded bg-purple-500/20 text-purple-400 text-xs">
            ðŸŽµ Audio
        </span>
        {% elif file.file_type == 'pdf' %}
        <span class="inline-flex items-center gap-1 px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs">
            ðŸ“„ PDF
        </span>
        {% else %}
        <span class="inline-flex items-center gap-1 px-2 py-1 rounded bg-gray-500/20 text-gray-400 text-xs">
            ðŸ“Ž File
        </span>
        {% endif %}
    </td>

    <!-- File Name -->
    <td class="py-3">
        <div class="max-w-xs truncate text-white" title="{{ file.file_name }}">
            {{ file.file_name or 'Unknown' }}
        </div>
        {% if file.channel_name %}
        <div class="text-xs text-gray-500 truncate">
            from {{ file.channel_name }}
        </div>
        {% endif %}
    </td>

    <!-- Size -->
    <td class="py-3 text-gray-400">
        {% if file.file_size %}
        {% if file.file_size < 1024 %} {{ file.file_size }} B {% elif file.file_size < 1048576 %} {{ (file.file_size /
            1024)|round(1) }} KB {% elif file.file_size < 1073741824 %} {{ (file.file_size / 1048576)|round(1) }} MB {%
            else %} {{ (file.file_size / 1073741824)|round(2) }} GB {% endif %} {% else %} -- {% endif %} </td>

            <!-- Category -->
    <td class="py-3">
        {% if file.status == 'PENDING' %}
        <form hx-post="/files/{{ file.id }}/category" hx-target="#file-row-{{ file.id }}" hx-swap="outerHTML"
            hx-trigger="change">
            <select name="category" class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-xs text-white">
                {% set file_type = file.file_type or 'other' %}
                {% set options = mime_options.get(file_type, []) %}
                {% for opt in options %}
                <option value="{{ opt }}" {% if file.destination_category==opt %}selected{% endif %}>
                    {{ categories[opt].label }}
                </option>
                {% endfor %}
            </select>
        </form>
        {% else %}
        <span class="text-gray-400 text-xs">
            {{ categories.get(file.destination_category, {}).get('label', file.destination_category or '--') }}
        </span>
        {% endif %}
    </td>

    <!-- Date -->
    <td class="py-3 text-gray-400 text-xs">
        {% if file.created_at %}
        {{ file.created_at.strftime('%Y-%m-%d %H:%M') }}
        {% else %}
        --
        {% endif %}
    </td>

    <!-- Actions -->
    <td class="py-3 text-right">
        {% if file.status == 'PENDING' %}
        <button hx-post="/files/{{ file.id }}/approve" hx-target="#file-row-{{ file.id }}" hx-swap="outerHTML"
            class="px-3 py-1 rounded text-xs font-medium text-white"
            style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
            Approve
        </button>
        {% elif file.status == 'QUEUED' %}
        <span class="px-3 py-1 rounded bg-blue-500/20 text-blue-400 text-xs">
            Queued
        </span>
        {% elif file.status == 'DOWNLOADING' %}
        <span class="px-3 py-1 rounded bg-cyan-500/20 text-cyan-400 text-xs animate-pulse">
            Downloading...
        </span>
        {% elif file.status == 'UPLOADING' %}
        <span class="px-3 py-1 rounded bg-amber-500/20 text-amber-400 text-xs animate-pulse">
            Uploading...
        </span>
        {% elif file.status == 'COMPLETED' %}
        <span class="px-3 py-1 rounded bg-green-500/20 text-green-400 text-xs">
            âœ“ Done
        </span>
        {% elif file.status == 'FAILED' %}
        <div class="flex items-center gap-2 justify-end">
            <span class="px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs" title="{{ file.error_message }}">
                Failed
            </span>
            <button hx-post="/files/{{ file.id }}/retry" hx-target="#file-row-{{ file.id }}" hx-swap="outerHTML"
                class="px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-xs">
                Retry
            </button>
        </div>
        {% elif file.status == 'FAILED_PERMANENT' %}
        <span class="px-3 py-1 rounded bg-red-900/30 text-red-400 text-xs" title="{{ file.error_message }}">
            âœ• Permanent
        </span>
        {% endif %}
    </td>
</tr>